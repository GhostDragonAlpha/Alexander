
<!DOCTYPE html>
<html>
<head>
    <title>Playtesting Dashboard</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            background-color: #333;
            color: white;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .status-card {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status-card h3 {
            margin-top: 0;
            color: #333;
        }
        .metric {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
        }
        .metric-value {
            font-weight: bold;
            color: #007bff;
        }
        .test-result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 3px;
        }
        .test-result.passed {
            background-color: #d4edda;
            color: #155724;
        }
        .test-result.failed {
            background-color: #f8d7da;
            color: #721c24;
        }
        .test-result.error {
            background-color: #fff3cd;
            color: #856404;
        }
        .issue-critical {
            border-left: 4px solid #dc3545;
            padding-left: 10px;
        }
        .issue-high {
            border-left: 4px solid #fd7e14;
            padding-left: 10px;
        }
        .issue-medium {
            border-left: 4px solid #ffc107;
            padding-left: 10px;
        }
        .issue-low {
            border-left: 4px solid #28a745;
            padding-left: 10px;
        }
        .screenshot-container {
            text-align: center;
            margin: 20px 0;
        }
        .screenshot-container img {
            max-width: 100%;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        button {
            padding: 10px 20px;
            margin: 0 10px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button.start {
            background-color: #28a745;
            color: white;
        }
        button.stop {
            background-color: #dc3545;
            color: white;
        }
        button:hover {
            opacity: 0.8;
        }
        .refresh-indicator {
            text-align: center;
            color: #666;
            font-size: 12px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Playtesting Dashboard</h1>
            <p>Session: <span id="session-id">-</span> | Iteration: <span id="iteration">-</span></p>
        </div>
        
        <div class="controls">
            <button class="start" onclick="startPlaytesting()">Start Playtesting</button>
            <button class="stop" onclick="stopPlaytesting()">Stop Playtesting</button>
        </div>
        
        <div class="status-grid">
            <div class="status-card">
                <h3>Test Results</h3>
                <div id="test-summary"></div>
                <div id="recent-tests"></div>
            </div>
            
            <div class="status-card">
                <h3>Performance</h3>
                <div id="performance-summary"></div>
            </div>
            
            <div class="status-card">
                <h3>Issues</h3>
                <div id="issues-summary"></div>
            </div>
        </div>
        
        <div class="status-card">
            <h3>Current Screenshot</h3>
            <div class="screenshot-container">
                <img id="screenshot" src="" alt="No screenshot available" style="display:none;">
                <p id="no-screenshot">No screenshot available</p>
            </div>
        </div>
        
        <div class="status-card">
            <h3>Recent Issues</h3>
            <div id="recent-issues"></div>
        </div>
        
        <div class="refresh-indicator">
            Auto-refreshing every <span id="refresh-interval">-</span> seconds
        </div>
    </div>
    
    <script>
        let refreshInterval;
        
        function updateDashboard() {
            // Update status
            fetch('/api/status')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById('session-id').textContent = data.session_id || '-';
                        document.getElementById('iteration').textContent = data.current_iteration || '-';
                    }
                });
            
            // Update test results
            fetch('/api/test_results')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const summary = data.summary;
                        document.getElementById('test-summary').innerHTML = `
                            <div class="metric">
                                <span>Total Tests:</span>
                                <span class="metric-value">${summary.total}</span>
                            </div>
                            <div class="metric">
                                <span>Success Rate:</span>
                                <span class="metric-value">${summary.success_rate.toFixed(1)}%</span>
                            </div>
                        `;
                        
                        const recentTests = document.getElementById('recent-tests');
                        recentTests.innerHTML = data.results.slice(-5).map(result => `
                            <div class="test-result ${result.status}">
                                Iteration ${result.iteration}: ${result.scenario} - ${result.status}
                            </div>
                        `).join('');
                    }
                });
            
            // Update performance
            fetch('/api/performance')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const summary = data.summary;
                        document.getElementById('performance-summary').innerHTML = `
                            <div class="metric">
                                <span>Avg FPS:</span>
                                <span class="metric-value">${summary.avg_fps.toFixed(1)}</span>
                            </div>
                            <div class="metric">
                                <span>Min/Max FPS:</span>
                                <span class="metric-value">${summary.min_fps.toFixed(0)}/${summary.max_fps.toFixed(0)}</span>
                            </div>
                            <div class="metric">
                                <span>Avg Memory:</span>
                                <span class="metric-value">${summary.avg_memory.toFixed(0)} MB</span>
                            </div>
                        `;
                    }
                });
            
            // Update issues
            fetch('/api/issues')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const summary = data.summary;
                        document.getElementById('issues-summary').innerHTML = `
                            <div class="metric">
                                <span>Total Issues:</span>
                                <span class="metric-value">${summary.total}</span>
                            </div>
                            <div class="metric">
                                <span>Critical:</span>
                                <span class="metric-value" style="color: #dc3545;">${summary.critical}</span>
                            </div>
                            <div class="metric">
                                <span>High:</span>
                                <span class="metric-value" style="color: #fd7e14;">${summary.high}</span>
                            </div>
                        `;
                        
                        const recentIssues = document.getElementById('recent-issues');
                        recentIssues.innerHTML = data.issues.slice(-10).map(issue => `
                            <div class="issue-${issue.severity}">
                                <strong>${issue.severity.toUpperCase()}</strong>: ${issue.description}
                            </div>
                        `).join('');
                    }
                });
            
            // Update screenshot
            fetch('/api/screenshot')
                .then(response => response.json())
                .then(data => {
                    const screenshotImg = document.getElementById('screenshot');
                    const noScreenshot = document.getElementById('no-screenshot');
                    
                    if (data.success && data.screenshot) {
                        screenshotImg.src = 'data:image/jpeg;base64,' + data.screenshot;
                        screenshotImg.style.display = 'block';
                        noScreenshot.style.display = 'none';
                    } else {
                        screenshotImg.style.display = 'none';
                        noScreenshot.style.display = 'block';
                    }
                });
        }
        
        function startPlaytesting() {
            fetch('/api/control', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({action: 'start'})
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
            });
        }
        
        function stopPlaytesting() {
            fetch('/api/control', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({action: 'stop'})
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
            });
        }
        
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            // Set refresh interval
            const refreshInterval = {{ refresh_interval }};
            document.getElementById('refresh-interval').textContent = refreshInterval;
            
            // Initial update
            updateDashboard();
            
            // Set up auto-refresh
            setInterval(updateDashboard, refreshInterval * 1000);
        });
    </script>
</body>
</html>
